{% extends 'base.html' %}
{% load i18n two_factor sniplates %}

{% block title %}{% trans 'Login' %} | {{ block.super }}{% endblock %}
{% block page_title %}{% trans 'Login' %}{% endblock %}

{% block content %}

  {% load_widgets form='widgets/foundation.html' %}
  <form method="post">
    {% csrf_token %}

    {{ wizard.management_form }}

    {% widget 'form:NonFieldErrors' %}

    {% if wizard.steps.current == 'auth' %}

      {% form_field form.username autofocus=True %}
      {% form_field form.password %}

    {% elif wizard.steps.current == 'token' %}

      <p>{% trans 'Please enter the tokens generated by your token generator.' %}</p>
      {% form_field form.otp_token %}

    {% elif wizard.steps.current == 'backup' %}
      <p>
      {% blocktrans %}
        Use this form for entering backup tokens for logging in. These tokens have
        been generated for you to print and keep safe. Please enter one of these
        backup tokens to login to your account.
      {% endblocktrans %}
      </p>
      {% form_field form.otp_token %}

    {% endif %}

    {% if other_devices %}
      <p>{% trans 'Or, alternatively, use one of your backup phones:' %}</p>
      <p>
        {% for other in other_devices %}
        <button name="challenge_device" value="{{ other.persistent_id }}"
                class="button small" type="submit">
          {{ other|device_action }}
        </button>
      {% endfor %}</p>
    {% endif %}

    {% if backup_tokens %}
      <p>{% trans 'As a last resort, you can use a backup token:' %}</p>
      <p>
        <button name="wizard_goto_step" type="submit" value="backup"
                class="button tiny" formnovalidate>{% trans 'Use Backup Token' %}</button>
      </p>
    {% endif %}

    {% if wizard.steps.prev %}
      <div class="row">
        <div class="small-offset-3 small-9 columns">
          <button type="submit" class="button small">{% trans 'Login' %}</button>
          <button type="submit" class="button small secondary"
                  name="wizard_goto_step" value="{{ wizard.steps.prev }}" formnovalidate>
            {% trans 'Back' %}
          </button>
        </div>
      </div>
    {% else %}
      {% url 'accounts:create' as url %}
      {% widget 'form:Submit' label='Login' secondary='Register' secondary_url=url %}
    {% endif %}
  </form>

{% endblock %}
